# 羽毛球馆预约自动化系统

该项目是针对上海海洋大学羽毛球馆预约系统的自动化解决方案，能够帮助用户自动登录、识别验证码（通过OCR），并提交指定时间段的预约申请。

## 功能

- **自动登录**：使用账号密码自动登录到羽毛球馆预约系统。
- **验证码处理**：自动获取验证码并使用 OCR 技术（通过 `ddddocr`）进行识别。
- **场馆预约**：根据指定的时间段和房间提交预约申请。
- **错误处理**：提供验证码错误或请求失败时的重试机制。

## 前置条件

- Python 3.x 环境
- 稳定的网络连接
- `.env` 文件中提供的环境变量（如用户名、密码、token等）

## 安装步骤

1. **克隆仓库**：
    ```bash
    git clone https://github.com/CodeVoyagerWgy/BC-SHOU.git
    cd BC-SHOU
    ```

2. **安装依赖**：
    请确保已安装 `pip`，然后运行以下命令安装项目所需的 Python 依赖包：
    ```bash
    pip install -r requirements.txt
    ```

3. **设置 `.env` 文件**：
    在项目根目录下创建 `.env` 文件，并根据实际情况填入以下内容：
    ```
    USERNAME=你的用户名
    PASSWORD=你的密码
    TOKEN=已有的 token（可选）
    ROOM_ID=房间ID
    START_TIME=预约开始时间
    END_TIME=预约结束时间
    APPLY_DATE=预约日期
    ```

    示例：
    ```
    USERNAME=m220951640
    PASSWORD=wangguiyou123
    TOKEN=
    ROOM_ID=1805787236174073857
    START_TIME=18:00
    END_TIME=18:30
    APPLY_DATE=2024-10-16
    ```

## 使用说明

1. **运行脚本**：
    通过以下命令运行主脚本，系统会自动完成登录、验证码识别并尝试预约房间：
    ```bash
    python Main.py
    ```

2. **登录与预约**：
    - 如果 `.env` 文件中没有设置 token，脚本将使用用户名和密码自动进行登录，并在成功后将 token 写入 `.env` 文件。
    - 如果存在有效的 token，脚本将跳过登录步骤，直接进行预约。

3. **环境变量**：
    脚本使用以下环境变量：
    - `USERNAME`：你的登录用户名（必填 ）。
    - `PASSWORD`：你的登录密码（必填）。
    - `TOKEN`：可选，如果已有 token，脚本将使用该 token。
    - `ROOM_ID`：需要预约的房间ID。
    - `START_TIME`：预约的开始时间。
    - `END_TIME`：预约的结束时间。
    - `APPLY_DATE`：预约的日期。

## 依赖说明

- `requests`：用于发送 HTTP 请求，如登录、查询和预约操作。
- `ddddocr`：用于 OCR 识别验证码图片。
- `python-dotenv`：用于从 `.env` 文件中加载环境变量。

## 主要工作流程

1. **登录系统**：脚本会使用提供的用户名和密码向登录接口发送请求，获取 ID token。
   
2. **查询预约信息**：脚本会检查指定日期的预约状态，获取可用房间信息。

3. **处理验证码**：脚本会获取验证码图片，并使用 `ddddocr` 进行验证码识别。

4. **提交预约**：使用验证码及其他必要信息，脚本向预约接口发送请求，提交预约申请。

5. **重试机制**：如果验证码识别错误或其他问题导致预约失败，系统会自动进行最多 3 次重试。

## 自定义配置

你可以通过 `.env` 文件或直接在代码中修改以下参数：

- `ROOM_ID`：需要预约的房间ID。
- `START_TIME`：预约的开始时间。
- `END_TIME`：预约的结束时间。
- `APPLY_DATE`：预约日期。

示例 `.env` 文件内容：
```
ROOM_ID=1805787236174073857
START_TIME=18:00
END_TIME=18:30
APPLY_DATE=2024-10-16
```