# 羽毛球馆预约自动化系统

该项目是上海海洋大学羽毛球馆系统预约的自动解决方案。它能够自动登录、识别验证码（使用OCR）并提交指定时间段的预约请求。

## 功能

- **自动登录**：自动登录到预约系统。
- **验证码处理**：自动获取并通过OCR识别验证码（使用 `ddddocr`）。
- **会议室预约**：提交指定会议室的预约申请。
- **错误处理**：针对验证码错误或请求失败的情况提供重试逻辑。

## 前置条件

- Python 3.x
- 稳定的网络连接
- 必需的环境变量（用于登录）

## 安装

1. **克隆仓库**：
    ```bash
    git clone https://github.com/your-username/meeting-room-reservation.git
    cd meeting-room-reservation
    ```

2. **安装依赖**：
    请确保已安装 `pip`。运行以下命令安装项目所需的Python依赖包：
    ```bash
    pip install -r requirements.txt
    ```

3. **设置 `.env` 文件**（可选）：
    如果你想更安全地管理 `USERNAME` 和 `PASSWORD` 等敏感信息，可以在项目根目录下创建 `.env` 文件，并添加以下内容：
    ```
    USERNAME=你的用户名
    PASSWORD=你的密码
    TOKEN=如果已有可用的token，可以放在这里
    ```

## 使用说明

1. **运行脚本**：
    主脚本会自动登录、获取验证码、进行OCR识别，并尝试预定会议室。

    ```bash
    python reservation.py
    ```

2. **登录处理**：
    - 如果 `.env` 文件中没有设置 token，脚本将使用用户名和密码自动进行登录。
    - 如果已存在有效 token，脚本将跳过登录步骤，直接进行预约。

3. **环境变量**：
    脚本使用以下环境变量：
    - `USERNAME`：你的登录用户名（默认为 `m220951640`）。
    - `PASSWORD`：你的登录密码（默认为 `wangguiyou123`）。
    - `TOKEN`：可选。如果已有有效的 token，可以通过此变量直接跳过登录。

## 依赖

- `requests`：用于发送HTTP请求以登录和预约。
- `ddddocr`：用于OCR识别验证码图片。
- `python-dotenv`：用于从 `.env` 文件加载环境变量。

## 示例工作流程

1. **登录**：脚本会向登录接口发送POST请求，使用你的凭据进行登录。如果成功，将会获取ID token。
   
2. **查询预定信息**：脚本会查询可用的房间，并检查指定日期的预约状态。

3. **验证码处理**：脚本会获取验证码图片，并通过 `ddddocr` 识别验证码。

4. **提交预约**：使用识别出的验证码和其他必要信息，脚本会发送POST请求，提交预约。

5. **重试机制**：如果验证码识别错误，脚本会进行几次重试（默认：3次）。

## 自定义配置

你可以直接在代码中修改以下参数，也可以通过环境变量传递：

- `room_id`：要预约的房间ID。
- `start_time`：预约开始时间。
- `end_time`：预约结束时间。
- `apply_date`：预约日期。

示例：
```python
room_id = '1805787236174073857'
start_time = '18:00'
end_time = '18:30'
apply_date = '2024-10-16'
